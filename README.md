# STL Autom8

- This is my first GitHub project so a lot of things may be incorrect, misplaced, redundant or missing.
- I'm non-native en so I apologize for every mispell or grammar errors.

The Autom8 project is meant to optimize and automate 2D geometries extraction from .STL files that contain geometric data about propellers and rotors.
The code also builds an aerodynamic database to make a brief analysis of how the geometry will perform.

***In order to run properly, the code requires a .exe of Xfoil***




The following user manual is outdated, but the main concepts and functions that are explained are still valid.




**Summary**

**1. Introduction**

- 1.1 Pre-processing and Rot8 code
- 1.2 Xfoil

**2. Code Body**

- 2.1 Run.m
- 2.2 Secondary Level Modules called by Run.m
  - 2.2.1 Geometry extractor
  - 2.2.2 Database Generator
  - 2.2.3 Database Filler
  - 2.2.4 Polar Menu
  - 2.2.5 Folder Manager
  - 2.2.6 Twist and Chord Distribution Plotter

**3. Utility Manual & Run example**

**4. Validation**

**5. Conclusion**

**6. References**

**1. Introduction**

The STL Autom8 is designed to completely automate the task of extracting two-dimensional geometries from an STL file and analyzing them with external software, specifically Xfoil [1]. The main purpose of the code is to provide a fast and fairly accurate preview of how a geometry could perform, before committing to a long and heavy computational process. This saves valuable time by identifying errors and correcting defects early on or by giving a rough idea of how the geometry will behave.

The ultimate result of the preprocessing is an aerodynamic database of CL and CD coefficients, generated for the 3D geometry, which can be accessed almost instantly. This allows the user to retrieve specific data about a section of the geometry under certain conditions. Each value results from calculations done on a unique combination of variables commonly used in aerodynamics that determine lift and drag properties. In this case, Alpha, Reynolds number (Re), Mach number and profile shape are the variables considered when generating the database.

**1.1 Pre-processing and Rot8 code**

Rot8[2] is a code developed by Carreño Ruiz et al. [2] that predicts the performance of rotary wing. It uses fundamental aerodynamics theories and theorems like Prandtl lifting line theory, Biot-Savart law and Helmholtz Vortex Theorems to determine the field of motion generated by the geometry rotation. In particular, Rot8 implements three reduced order models, a Blade Element Momentum (BEM) method, a Free Vortex Wake (FVW) method and a Vortex Particle Method (VPM). The aforementioned models allow different fidelity modelling of the wake. However, the reliability of the predictions is highly influenced by the fidelity of the aerodynamic database of the airfoils composing the rotor. Apart from the aerodynamic database, the code requires geometrical details of the blade that include the radial distributions of chord, twist, and quarter chord positions. These inputs along with the airfoil polars are currently provided manually. Considering that these are highly case-specific, the use of the code for the analysis of multiple geometries is very time-consuming.

The pre-processing nature of STL Autom8 is to effectively and automatically extract geometric data about the profile, submitted in a compact and easy to read format, eliminating the repetitive CAD task of manually slicing and analyzing 3D files. The first module produces a table where this information is stored. This is the data required as input by the Rot8 module.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 007](https://github.com/user-attachments/assets/80f72893-6714-4fa0-93e8-dbff1eb64d2c)

*An example of the data automatically collected by the geometry extractor module.*

**1.2 Xfoil**

XFOIL [1] uses an algorithm that combines a potential flow panel method with an integral boundary layer formulation.

A panel method in aerodynamics is a computational technique used to estimate the flow around an airfoil. It discretizes the surface of the object into small panels, each representing a segment of the surface. Potential flow theory, assuming inviscid and incompressible flow, is applied to calculate the velocity and pressure distributions over the object. This method helps in predicting lift, drag, and other aerodynamic characteristics efficiently without solving the full Navier-Stokes equations.

Xfoil is designed for estimating airfoil efficiently also at low Reynolds numbers due to the coupled inviscid-viscous analysis using an integral boundary layer formulation. Xfoil can also account for laminar separation bubbles and mild trailing edge separation. In the STL Autom8 code Xfoil is called by a MATLAB subroutine that is optimized to improve robustness in cases in which Xfoil crashes. Due to convergence issues or errors in geometry extraction, it may generate incorrect values, or loop indefinitely. For this reason, a fine-tuned routine is designed to forcefully kill the task and replace incorrect values with interpolation methods.

To compute transition, XFOIL employs the estimated e^N envelope approach. This technique involves monitoring the most amplified frequency at a specific location downstream from the instability point on the airfoil to determine the disturbance magnitude. When the integrated amplitude exceeds an empirically defined threshold, transition is presumed and the boundary layer solver switches from laminar to turbulent.

**2. Code Body**

The code is divided into subroutines for order and to allow multiple calls or specific tasks.

**2.1 Primary Level Module: run.m**

This module contains function calls to every other routine in the software. It also holds the main parameters that can be modified by the user, determining accuracy and features enabled during the run.

**2.2 Secondary Level Modules Called by run.m**

**2.2.1 Geometry Extractor**

This subroutine analyses the STL geometry and extracts 2-D profiles at set intervals. Initially, a geometry reposition tool rotates and correctly positions the geometry. Points and their connections are extracted, and for every z-step, an xy plane is generated. Interceptions with parametric lines are calculated to extract relevant points. The extracted geometry is then scaled, rotated, and cleaned using a customized polyval function. Further refinements include trailing edge adjustment, point ordering, chord value calculation, and attack angle determination. All data is written to text files for processing by subsequent modules.

**2.2.2 Database Generator**

The routine feeds 2-D geometry data to Xfoil and evaluates Cl and Cd. It generates ranges for maximum Reynolds and Mach numbers and stores results in a 4-dimensional database. A function detects failed Xfoil calls and replaces void values with MATLAB’s NaN values, which are processed by the Database Filler module.

**2.2.3 Database Filler**

This module handles NaN values left by the previous module. It scans the database, interpolates missing values, and deletes excessively corrupted profiles if necessary. As the database for each profile is a 3D matrix, the filling module analyses one row at time. Such task is achieved by keeping 2 of 3 values constant and variating the last one. This method produces a row of values. The interpolation is done on the selected row if necessary. The algorithm is also designed to look for the best interpolation direction eligible: if the row obtained by variating the Mach number can’t be interpolated, then it will swap to the Reynolds variation row and so on. If all the interpolation fails the profile is entirely removed from the database. After filling, geometric data from the geometry extractor is added to the database. The script also outputs accuracy data based on the number of failed Xfoil calls.

**2.2.4 Polar Menu (and Interpolation Polar Subroutine)**

This subroutine provides a GUI for users to access specific aerodynamic data. It uses 3D interpolation to derive CL and CD values for different Alpha, Reynolds, and Mach values, and 1D interpolation for different profiles.

**2.2.5 Folder Manager**

This subroutine checks the correct execution of other modules and verifies file locations.

**2.2.6 Twist and Chord Distribution Plotter**

An optional module that compares data extracted from benchmark aeroacoustics papers with data from this software.

**3. Utility Manual & Run Example**

This section feats a full run with all parameter’s description, to provide a guide trough every step.

In the Run.m routine are located the main parameters passed to every other module that determines the qualities of the execution.

**The save paths (line 14)** determine where folders and other files are stored. It is suggested to leave them to their default values tough it won’t affect run properties.

**In the main options section (line 38)** there are the flags that trigger every module. They can be selected to choose which module will be run. Every flag needs the previous one to be true to generate a meaningful result as every module needs previous module data.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 008](https://github.com/user-attachments/assets/002c245f-cbd2-4e46-847c-816315886579)
*Figure 1. Constant prompt*

At first a prompt will be opened for the user (Figure 1) to insert constant aerodynamic values such as cinematic viscosity, rotation speed and STL file unit measure, with the default ones inserted being standardly used.

The next prompt asks for the user to input the path for the STL geometry that will be used for the run. STL files are stored in STL/ directory and can be added manually there to be read.

If the **ExtractProfiles** flag is true, the user is asked if they want to edit the geometry before submitting. This will open a small editor for rotation and will also let the user save/load an edited 3D matrix in the TR/ directory.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 009](https://github.com/user-attachments/assets/8f8aa1f7-b224-420e-87ec-c2e610caad0d)
*Figure 2. Positioning example*

Figure 2 is an example of how a geometry should be positioned in the axis to be properly processed. After finishing the rotation edits the user should simply close the geometry fix window and accept the result or save the TR for different elaborations.

*Note: for a better result every axis should be in the positive range, with the tip being at the lowest Z coord and the root at the max Z coord.*

After confirmation, the geometry will be processed by the GeometryExtractor.

**Geometry extractor options (line 65)** allow the user to adjust some slicing and plot settings.

- GenerateGif generates a gif “sequence.gif” that will show how the slicing is done along the Z coordinate and the rest of the elaboration in a compact way.
- The number of slices generated is the steps variable.
- DebugGraphNumbered will show additional information about the points that are passed to Xfoil for further analysis and how they are ordered.
- HoldGraphs leaves all graphs open.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 010](https://github.com/user-attachments/assets/3ba88c68-4b4f-4457-a122-a3f980496c25)

*Figure 3. Slicing plane highlighted in yellow, attack border details with numbered points in debug graph*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 011](https://github.com/user-attachments/assets/104ff833-7d06-46d9-8cd1-22ae064e3419)

*Figure 3. Close view of a Leading Edge in debug graph*

The following figures from 4 to 7 are the result of a 4-step analysis.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 012](https://github.com/user-attachments/assets/faee8c5d-bfef-4563-8790-b3c07de16137)

*Figure 4. Step 1/4*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 013](https://github.com/user-attachments/assets/483f0161-1272-472d-b085-ff8fb1cfb038)

*Figure 5. Step 2/4*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 014](https://github.com/user-attachments/assets/ddf78077-b1a4-486a-9add-1886db6775a3)

*Figure 6, Step 3/4*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 015](https://github.com/user-attachments/assets/332bdfbb-9923-4cfa-ad46-97a62c40a664)

*Figure 7. Step 4/4*

Every image contains detailed information about data extracted.![img](Aspose.Words.2c59a413-7bad-401d-8b4c-e83125f8a89a.016.png)

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 016](https://github.com/user-attachments/assets/def8456e-486d-4ffe-8dd2-3f6c1e2fb860)

*Figure 8. Zoom on step 2/4*

Real measures are the exact coordinate where the points have been detected, without further elaboration.

Rotated translated scaled raw data corresponds to the previous data after being repositioned according to the NACA standard for profiles. The red dot is the x25 y25 position.

Generated intersections are the points that have been generated by the intersection of the parametric lines connecting the mesh with the yellow plane rendered in the reference visualization. They are generally more accurate.

Rotated translated scaled generated intersections correspond to the previous points, but adapted to the NACA standard, as the raw data has been treated before.

The final result before polyroot is the output of an algorithm that orders profile’s points counterclockwise, according to how Xfoil needs this set of points. It will use intersection points, if possible, otherwise uses raw data.

The polyroot interpolation boosts a customized variation of MATLAB’s polyfit function, realized by Manuel Carreno Ruiz. The default polyfit fails where there are vertical oriented lines like in the leading edge. This is covered by adding an exp^ (1/2) term to the function. Then it is evaluated in a cosinusoidal distribution, denser in leading and trailing edge. Top and bottom are evaluated separately with different parameters (as it can be seen by the different colours) due to the propension of the bottom to oscillate. The true final points that will be used to generate the accurate profile are represented by blue dots.

Final result is the profile made up by polyroot interpolation points and will be used by Xfoil.
The following step is the database generation.

**The Xfoil database options** (line 77) include some parameters that will affect database generation time, accuracy and density, other than some parameters that will be passed directly to Xfoil.

- DebugLogXfoil

  If true lets Xfoil print its own process output to MATLAB’s console. I recommend leaving it as false and use only for debug, because it will loop indefinitely the code when Xfoil encounters a non-convergent case and produces an infinite stream of output.
- Killtime-s
  It must be an integer positive value. This is the time MATLAB waits before declaring an Xfoil call failed. Increase this value if running on a low-end machine.
- aDensity, MachDensity, ReDensity

  These variables control the database density. This is the number of values that will be used to generate ranges between maximum and minimum values of each dimension such as alpha, Reynolds and Mach.
- n\_iter and n\_crit

  Xfoil parameters that control the number of iterations and the critical amplification factor.

  Refer to Xfoil manual to adjust such parameters based on your machine.

After the database generation is done, the console will log statistics as shown in figure 9 about the completion rate and the accuracy of every profile.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 017](https://github.com/user-attachments/assets/79ae00ee-1b8c-402a-92b4-b4ac35ca6c9d)

*Figure 9. XFOIL success rate in creating database*

**The next step is the Database filling. Filling parameters are on line 94.**

It is mostly automatized, so it does not require many parameters.

- RemovingThreshold

  The minimum number of values a row\* must have, or it will cause profile deletion.

  \*Refer to **2.2.3 Database Filler**
- percTreshold

  An additional check to interpolate on more consistent rows.
  The filler will look to better populated rows before interpolating to obtain more consistent data. 100 disables this check, 0-15 likely discards everything.

**After the filling process the Database is ready to be used** for polar calculations and contains everything it is needed for a fast aerodynamic processing.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 018](https://github.com/user-attachments/assets/7c77adbd-4232-42c7-9271-5271a49e2de4)

*Figure 10. Calculation menu*

In the figure 8 menu the user can choose if they need a single specific value or if they like to see a Cl-alpha. Polar-like plots are still in development. Every Cl-alpha or CD-alpha curve is plotted on the same figure for simple comparison. The single value output is instead printed on console. Please be sure to insert values that respect the boundaries of the database. Examples in figures 11-12.

Single value output example that will be logged in console is this format:
*CL = 1.078124e+00 for r=0.50 a=5.00 Re=200000.00 Mach=0.10*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 019](https://github.com/user-attachments/assets/cf4ec398-9845-48b7-b9c3-aa6ccaf5aea4)

*Figure 11. CL-Alpha curve with different parameters of T-motor geometry*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 020](https://github.com/user-attachments/assets/26a409b4-cdb0-447f-ac0b-0f4ed9718fb4)

*Figure 12. CD-Alpha curve with different parameters of T-motor geometry*

**4. Validation**

In this section a series of comparisons are made to ensure that the data automatically extracted matches the data that has been calculated in Wind Tunnel and Hover Performance Test Results for Multicopter UAS Vehicles [3], in particular to T-motor 15x5 CF geometry.

All the comparisons in figures 13-18 are realized between Autom8 software extraction and the values reported on the T-motor 15x5 CF geometry, shown as “Reference”.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 021](https://github.com/user-attachments/assets/709e23c3-c5b9-493c-8248-2e310f2b988e)

*Figure 13. Chord distribution comparison*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 022](https://github.com/user-attachments/assets/c3079d0a-7b47-4909-a233-be8649111981)

*Figure 14. Twist distribution comparison.*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 023](https://github.com/user-attachments/assets/2cb6ddfb-6745-4313-b5e1-b189680e2961)

*Figure 15. y25 distribution*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 024](https://github.com/user-attachments/assets/f9c0a56b-e7e1-4e83-9296-0dbc152496d3)

*Figure 16. x25 Distribution*

As it can be noticed **the distribution of x25 and y25 is different from the reference one by a constant value**. This is due to the rigid translation of the geometry before the Geometry Extractor analysation. By defining the origin point coords in the STL matrix and standardizing input position of STL file this error can be removed, as shown in figure 17.

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 025](https://github.com/user-attachments/assets/551da7e4-e9fb-49f2-b2f9-c4971e53a916)

*Figure 17. Comparison between x25 distributions when considering the translation parameter.*

![Aspose Words 2c59a413-7bad-401d-8b4c-e83125f8a89a 026](https://github.com/user-attachments/assets/10d2e2b5-db53-436d-920a-64c34e592e1e)


*Figure 18. Comparison between the T-motor 15X5 CF profile and the extracted profile for a r/R of approximately 0.5
‘ \* ’ is reference, red line is calculated by Autom8*

**5. Conclusion**

In conclusion, the STL Autom8 software provides a comprehensive and automated solution for extracting and analysing aerodynamic geometries. It focuses on automatizing the aerodynamic database building, taking as input the output of a 3D scan, allowing the code to be automatically executed after a 3D scanning routine. The various modules also provide a handle for extracted 2D geometries that will be repositioned and modified to give the best input possible to Xfoil, in order to obtain valid results. Every module contains modifiable parameters that can be tuned to fit user-specific needs. An example is the database density for more accurate results to the detriment of execution time. The code also provides an interface with XFOIL, allowing multiple calls with a robust crash-proof method and an automated output storing system; the extracted data is stored in MATLAB objects that can be rapidly re-analysed later. By implementing all mentioned features, STL Autom8 saves time, improves efficiency, user experience, and applicability.

**6. References**

[1] Drela, Mark. "XFOIL: An analysis and design system for low Reynolds number airfoils." *Low Reynolds Number Aerodynamics: Proceedings of the Conference Notre Dame, Indiana, USA, 5–7 June 1989*. Berlin, Heidelberg: Springer Berlin Heidelberg, 1989.

[2] Carreno Ruiz Manuel and D'Ambrosio. Domenic. "ROT8: A Matlab App for Low Reynolds number Airfoil and Rotor Aerodynamic Design." *AIAA AVIATION 2023 Forum*. 2023.

[3] Russell, Carl R., et al. "Wind tunnel and hover performance test results for multicopter uas vehicles." *American Helicopter Society (AHS) International Annual Forum and Technology Display*. No. ARC-E-DAA-TN31096. 2016.

**Thanks**

%Since this work is probably the final part of my university career and my degree thesis, I

%would like to spend a couple words and make some considerations.

%It has been a difficult, stressful and long path, which took me 5 years to

%complete. During my journey I’ve found interesting courses, others less enjoyable,

%but all around everything was pretty difficult. I've always thought "I'm

%not doing something easy so I shouldn't worry if I fail", but the sorrow

%that comes when you can’t overcome an obstacle or just the anxiety that this fear causes, remains.

%Everyone always says that you should not give up, and I agree, or I wouldn’t be here writing this,

%but it's easy to talk after you've finished as I'm now. When you're not it's complicated.

%And this is something that almost every University student can share. Especially when your loved ones

%are far away from you. I've also lost very important people during my journey,

%metaphorically and, unfortunately, in a more literal way.

%What saved me and made me succeed were the people that stayed with me

%and the ones that I met. Gaming nights, pub nights and also just simple

%chatting. I want to thank my family, for never letting me feel alone even when

%they were the ones that missed me, and for never letting me in lack of

%anything.

%I want to thank my old friends for not leaving me despite the

%distance.

%I want to thank the friends that I made here, for being together

%with me in this path.

%I want to thank my girlfriend for her patience in

%listening me repeat something that for her sounded like Arabic nonsense

%and for all the happy moments we had.

%I want to thank Manuel that followed me during this whole project and for lending me a big hand.

%Thank you everyone.

%Pursue your ambitions.

18
